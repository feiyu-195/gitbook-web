{"./":{"url":"./","title":"Introduction","keywords":"","body":"写在开头 本站会不定期分享一些关于IT运维相关的文章，由于受时间、技术水平和能力的限制，可能存在表述不准确的地方，仅供一起讨论学习。 推荐阅读 AWD-Guide Docker推送镜像至仓库 Ubuntu镜像源加速 Vim配置与美化 NPM镜像加速 Openssl创建自签名证书 赣ICP备2023008387号-1 赣公网安备36052102100040号 Copyright ©2022 - 2024 By Feiyu最近一修改时间： 2025-04-10 16:08 "},"1.网络概述/1.网络企业基础架构.html":{"url":"1.网络概述/1.网络企业基础架构.html","title":"1.网络企业基础架构","keywords":"","body":" 网络：似宇宙洪荒，浩瀚无边，深不可测；网络案例似璀璨群星，千变万化，闪耀环宇。学习网络技术似夜观星象，每有所得，便拍案惊奇，夜不能寐。 路由交换类似于“路”，只有把路建好了，才能去别人家。 主要设备：交换机、路由器、防火墙 上网通常使用的是私网地址，并不能直接访问Internet，可以通过NAT技术 企业架构分层： 核心层：对用户流量进行高速处理转发 汇聚层：对用户的流量进行汇聚 接入层：用于接入用户，供用户访问服务 企业网络架构很大程度取决于企业或机构的业务需求： 小型企业 通常只有一个办公地点，一般采用扁平网络架构（没有层次化）进行组网。扁平网络架构能够满足用户对资源的基本访问需求，具有较强的灵活性，同时又能够大大减少部署和维护成本。网络通常缺少冗余机制，可靠性不高，容易发生业务中断。 大型企业 业务对网络的连续性要求很高，所以通常会通过冗余备份来保证网络的可用性和稳定性，从而保证企业的日常业务运营。网络也会对业务资源的访问进行控制，所以通常采用多层网络架构来优化流量分布，并应用各种策略进行流量管理和资源访问控制。多层网络设计也可以使网络易于扩展。网络采用模块化设计能够有效实现网络隔离并网络维护，避免某一区域产生的故障影响到整个网络。 运营商网络： 覆盖范围大（全省，全国……） 网络复杂 多厂商共存（华为、思科、华三……） 网络安全可靠性要求高（不能出现断网、被攻击……） 涉及的网络制式多（涉及多种协议） IDC数据中心 校园网 五大网：中国移动、中国电信、中国联通、教育网、科研网 赣ICP备2023008387号-1 赣公网安备36052102100040号 Copyright ©2022 - 2024 By Feiyu最近一修改时间： 2025-04-06 16:47 "},"1.网络概述/2.网络概述.html":{"url":"1.网络概述/2.网络概述.html","title":"2.网络概述","keywords":"","body":"网络概述： 硬件方面：通过介质（网线、无线……）将网络设备和终端设备连接起来 软件方面：操作系统、应用软件、应用程序互相通信 实现资源共享、信息传递 网络的组成： 术语 备注 设备 Device 介质 Media 消息/报文 Massage/Data 协议 Protocol 发送方/信息源 Sender/Source 接受发/信息目 Receiver/Destination 数据通信是双向的（保证数据的来回） 网络的演进： 小型主机互联形成了局域网LAN 多个局域网互联就成了internet 互联网 全球相连就形成了Internet 因特网 术语 备注 network 网络，一组互连、通信的设备 internet 互联网，多个互联互通的网络 Internet 因特网，互联全世界的网络 Internet组成： ISP：Internet service providers 因特网服务提供商，向用户提供互联网接入业务、信息业务、和增值业务，俗称运营商，如：电信、移动、联通 用户通过Internet互联 Internet通过ISP构建 用途 WAN服务 ISP 最后一公里接入（宽带接入） 光纤、LAN、ADSL 电信、移动、联通 移动通信 WinMAX、3G/4G/5G、公共无线LAN 电信、移动、联通 VPN 广域以太网、IP-VPN、以太网VPN 电信、移动、联通 专线 ATM、专线 电信、移动、联通 网络的类型：根据覆盖范围不同，组网技术不同（二层） 类型 备注 PAN （个人蓝牙、热点） Personal area network，个人网 LAN（多台主机构建） Local area network，局域网 CAN（大的局域网构建） Campus area network，园区网 MAN（一个城市构建） Metropolitan area network，城域网 WAN（城市与城市构建） Wide area network，广域网 WLAN（WiFi） Wireless local area network，无线局域网 WWAN（3G/4G） Wireless wide area network，无线广域网 协议：Protocol 网络通信中的“语言” 汉语和英文当作“协议” 聊天当作“通信” 说话的内容当作“数据” 决定数据的格式和传输的一组规则 What ？How ？When ？ 协议一致，通信轻松 网络性能指标： 带宽（bandwidth） 描述在单位时间内从一个节点到另一个节点的数据量 类似于水管的粗细、公路的宽度 以bps（bit per second 比特每秒）为单位 如：以太网贷款为10Mbps，快速以太网为100Mbps 延迟（delay） 描述在单位时间内从一个节点到另一个节点的时间 以ms为单位 网络拓扑：topology ，用来描绘网络结构（网络类型、设备类型、设备数量、线缆、带宽、服务、数据走向等）示意图 制作拓扑图的软件：PPT，visio，亿图，模拟器 拓扑类型：根据接口、线缆、封装判断 星型 特点：边缘设备故障不影响其他设备通信 缺点：核心设备故障影响所有设备通信 赣ICP备2023008387号-1 赣公网安备36052102100040号 Copyright ©2022 - 2024 By Feiyu最近一修改时间： 2025-04-06 16:47 "},"1.网络概述/3.网络模型.html":{"url":"1.网络概述/3.网络模型.html","title":"3.网络模型","keywords":"","body":"分层思想：将复杂的流程分解为几个功能相对单一的子过程 流程更加清晰，复杂问题简单化 更容易发现问题并针对性的解决问题 如：小黑喝牛奶不在乎中间的过程 用户不在乎中间的过程只在乎上网 制作牛奶的部门：就是为了方便管理，出现问题能够找到问题源 对于网络也需要分层：方便管理，出现问题能够找到问题源易于学习，各层之间的改变不影响其他层 网络标准化：规范不同的互联标准，互相兼容，加快网络发展 1974年前-各厂商都有自己的通信协议标准，导致不同厂商之间不兼容，影响互联网发展 1974年-提出OSI开放式互联参考模型协议，但是未被认可，TCP/IP协议认可 2000年至今通信都在使用遵守TCP/IP协议 OSI开放式互联参考模型： OSI未被广泛认可原因：层次太多麻烦复杂、功能重复 网络排错思想： 从下层到上层开始 从上层到下层开始 TCP/IP开发早于OSI，最终在市场获取认可，目前所使用的通信标准 数据封装和解封装： 应用数据需要经过逐层处理后才能通过网络传递给对方 OSI把每一层数据称为PDU（protocol data unit 协议数据单元） TCP/IP根据不同层分别使用段segment、包packet、帧frame、比特bit 发送者逐层向下传递数据，并添加报头和报尾的过程称为封装（打包） 反之，接收者逐层向上传递数据，称为解封装（拆包） TCP/IP协议簇中的常见协议： 赣ICP备2023008387号-1 赣公网安备36052102100040号 Copyright ©2022 - 2024 By Feiyu最近一修改时间： 2025-04-06 16:47 "},"1.网络概述/4.OSI参考模型.html":{"url":"1.网络概述/4.OSI参考模型.html","title":"4.OSI参考模型","keywords":"","body":"OSI参考模型的背景： 互联网早期并没有一个通信标准，导致各厂商之间使用自己的私有技术来实现通信，从而影响了网络的发展 国际标准化组织（International Organization for Standardization，ISO）在1984年正式提出OSI开放互联参考模型，定义了通信的基础标准，如今使用最广泛的TCP/IP协议就是基于OSI模型设计的（并不是具体的一种协议、应用，只是一种参考模型） OSI的分层结构：物理层、数据链路层、网络层、传输层、会话层、表示层、应用层 分层：模块化、标准化、流程化设计理念 带来的好处：减少复杂性、加速技术之间的兼容性、易于学习 每一个层次都是独立的， （如：工作在物理层的网卡的收发速率的改变，上层不需要变化） 但每一层都紧密相连 。 （如：工作在物理层的网卡出现故障，会导致上层都会收到影响 ） 各层的作用： 物理层：实现最基本的底层数据传输（传输方式、传输标准） 数据链路层：定义数据的基本格式（数据如何在线缆上传输，如何标识该数据，如何防止数据错误） 网络层：IP编址和路由功能（定义三层编址，提供在不同网络中转发的能力） 传输层：定义了端到端通信 （端到端连接、端到端之间传输数据、传输数据的速度、可靠性） 会话层：控制一个应用程序/一对IP地址（一对不同的会话，QQ、微信……） 表示层：定义数据的格式（定义数据的内容是图片JPG、视频AVI、文本TXT，压缩加密） 应用层：定义了应用协议（HTTP、SNMP） 数据传输封装和解封装： 封装：由上层到下层的逐级封装 数据由应用层产生，逐渐的往下走，每经过一个层都封装报头“穿马甲“ 解封装：由下层到上层的逐级解封装 每经过一层都会将报头解封装“卸马甲”，最终以原始的数据交付应用层 每层的数据报头的名词： TCP/IP协议： 根据OSI参考模型进行简化 TCP/IP与OSI模型的对比关系：（三层和四层比较重要保留） 每一层对应的协议： 赣ICP备2023008387号-1 赣公网安备36052102100040号 Copyright ©2022 - 2024 By Feiyu最近一修改时间： 2025-04-06 16:47 "},"2.VRP基础/1.概述.html":{"url":"2.VRP基础/1.概述.html","title":"1.概述","keywords":"","body":" VRP：version route platform 通用路由平台 华为公司具有完全自主知识产权的网络操作系统 可用运行多中硬件平台之上(路由器、交换机、防火墙) 拥有一致的网络界面、用户界面和管理界面，提供丰富的应用解决方案 集成了路由交换技术、QOS技术、安全技术和IP语言技术等数据通信功能 主要使用版本：VRPv5 高级版本v8 设备管理方式： 管理方式 登入方式 优点 缺点 应用场景 CLI命令行 console 使用console线缆连接 完全本地管理 单会话 无法远程 初始化 故障恢复 升级 CLI命令行 miniUSB 使用miniUSB线缆连接 完全本地管理 单会话 无法远程 初始化 故障恢复 升级 CLI命令行 Telnet 远程管理 多会话 明文传输 不安全 对安全性要求不高的网络 CLI命令行 SSH 远程管理 多会话 高安全性 配置较复杂 对安全性要求高的网络 管理方式 登入方式 优点 相同点 不同点 web图形化 HTTP 图形化界面，更直观 加载SSL证书用于登入认证，配置几乎相同 登入使用HTTPS，传输数据使用HTTP web图形化 HTTPS 图形化界面，更直观 加载SSL证书用于登入认证，配置几乎相同 登入和传输数据都是用HTTPS，需要开启命令 管理形式 备注 本地管理 local 通过console连接console口或miniUSB口，终端使用serial协议适合初始化，故障恢复系统升级 远程管理remote 通过IP地址或域名连接虚拟接口VTY口，使用Telnet或SSH适合后期维护、异地管理，同时支持多个会话 console线 赣ICP备2023008387号-1 赣公网安备36052102100040号 Copyright ©2022 - 2024 By Feiyu最近一修改时间： 2025-04-06 16:47 "},"2.VRP基础/2.基础命令.html":{"url":"2.VRP基础/2.基础命令.html","title":"2.基础命令","keywords":"","body":"VRP基本配置： 询问是否进入自动配置（一问一答模式）： VRP有很多中模式/视图，每个视图都有可执行的配置 常用的快捷键： 配置时间日期： 配置登入设备信息： 配置登入用户： 查看接口状态（二层或三层） 赣ICP备2023008387号-1 赣公网安备36052102100040号 Copyright ©2022 - 2024 By Feiyu最近一修改时间： 2025-04-06 16:47 "},"2.VRP基础/3.文件系统.html":{"url":"2.VRP基础/3.文件系统.html","title":"3.文件系统","keywords":"","body":" 设备内存 SDRAM 内存 （临时性存储） 断电后配置文件丢弃 （内存较大） Flash 闪存 （永久性存储） NVRAM 内存 断电后配置文件还在 （内存小） SD card SD卡 （永久性存储） USB （移动存储） 配置命令： pwd 显示当前所在的存储介质 dir 显示存储介质内的目录的文件 Mkdir 创建文件 More 显示记事本格式文件 CD /CD .. 进入目录 ，回到上一目录 Delete 将文件删除到回收站 Undelete 恢复删除的文件 Reset recycle-bin 清空回收站 rename重命名 Move 移动文件 Copy 复制文件 配置文件管理 显示当前配置文件 （断电丢失） 显示已保存的配置文件 保存当前配置文件 一个问题是问是否保存当前文件 第二个问题是问是否重启 格式化文件 格式化存储盘 赣ICP备2023008387号-1 赣公网安备36052102100040号 Copyright ©2022 - 2024 By Feiyu最近一修改时间： 2025-04-06 16:47 "},"2.VRP基础/4.远程管理.html":{"url":"2.VRP基础/4.远程管理.html","title":"4.远程管理","keywords":"","body":" 运行终端用户远程到任何可用充当Telnet服务器的设备 Telnet 服务器无需与终端用户直连，只要TCP可达 认证模式： 配置命令： Telnet server enable 开启telnet服务 Display telnet server 验证telnet服务 user-interface 0 4 set authentication-mode password/aaa user privilege level 15 user-interface maximum-vty 15 idle-timeout 10 进入VTY配置模式配置认证模式配置用户权限配置最大接入数配置超时时间 AAAlocal-user huawei password cipher huawei@123local-user huawei privilege level 15local-user huawei service-type telnet 进入AAA配置模式创建用户名和密码配置用户权限配置服务类型 赣ICP备2023008387号-1 赣公网安备36052102100040号 Copyright ©2022 - 2024 By Feiyu最近一修改时间： 2025-04-06 16:47 "},"2.VRP基础/5.系统管理.html":{"url":"2.VRP基础/5.系统管理.html","title":"5.系统管理","keywords":"","body":" VRP命名规则： 由VRP自身版本号和关联产品版本号两部分组成 产品版本格式包含设备型号 Vxxx （产品码），Rxxx（大版本号），Cxx（小版本号） 如果VRP产品版本有补丁，VRP产品版本中还包含SPC部分 文件传输协议 FTP可靠（在跨网段或广域网之间使用较好），TFTP不可靠 （在局域网内对可靠性要求不高使用较好） FTP传输的命令： TFTP传输的命令： Ftp 服务器地址Get 文件名 Tftp 服务器地址 get 文件名 FTP与TFTP的区别： 设备登入FTP需要输入账号密码，TFTP不需用 FTP传输会显示进度，TFTP不显示进度 FTP可用查看文件，TFTP不能查看 赣ICP备2023008387号-1 赣公网安备36052102100040号 Copyright ©2022 - 2024 By Feiyu最近一修改时间： 2025-04-06 16:47 "},"3.TCPIP协议/1.TCP与UDP.html":{"url":"3.TCPIP协议/1.TCP与UDP.html","title":"1.TCP与UDP","keywords":"","body":" 传输层提供端到端的连接（会话之间） 网络层提供点到点的连接（节点之间） 根据端口号可以区分不同的应用协议 传输层端口：Port 0~1023 属于公认端口/知名端口（给一些重要的协议使用的端口） 1024~49151属于注册端口/登记端口（应用注册使用的端口） 49152~65535属于私有端口/动态端口（主机/客户端使用的端口） 端口是根据需求自行更改的 可以通过更改端口可以让非信任用户访问不到应用 如FTP的端口默认为21，修改端口为9999，让非信任用户访问不到FTP服务器 客户端（source port 49152~65535） 服务器（source port 0~49152） 端口对应了一种应用协议，真正提供服务的是服务器 传输层协议： 协议 备注 TCP Transmission control protocol 传输控制协议可靠的、面向连接的协议传输效率低，类似于打电话 UDP User datagram protocol 用户数据报协议不可靠、无连接的服务传输效率高，类似于群聊 TCP在通信前需要建立关系来确认之间状态 UDP在通信前不需要建立关系来确认之间的状态 TCP与UDP数据包结构对比： TCP可靠，效率低 TCP会话的建立-三次握手：涉及标志位SYN,ACK 三次握手机制类似打电话：（确保身份状态的可靠性） 第一次握手： 第二次握手： 第三次握手： TCP会话的确认：对每个数据包都会进行确认（影响资源的消耗，推出滑动窗口机制，只对部分进行确认） TCP会话的拥塞和流量控制 根据窗口机制来控制网络拥塞（网络拥塞，主机接收服务器的数据不过来，服务器接收主机的请求不过来，可以根据窗口大小来调整） TCP会话的结束-四次握手：涉及ACK、FIN TCP的三次握手一定是三次交互报文，四次握手可能不会有四次交互报文（主机直接拔电） 网络中最霸道的攻击 DDos 黑客控制僵尸网络向服务器发送TCP SYN ，并不会对服务器的回应。 UDP：用户数据报协议 TCP与UDP的区别： 传输控制协议TCP 用户数据报协议UDP 面向连接 无连接 可靠传输 尽力而为的传输 支持流控及窗口机制 无流控及窗口机制 仅支持点对点通信 支持任意通信方式（点对点，点对多点） 多用于注重数据的完整性 不要求数据的完整性，开销小 赣ICP备2023008387号-1 赣公网安备36052102100040号 Copyright ©2022 - 2024 By Feiyu最近一修改时间： 2025-04-09 21:19 "},"3.TCPIP协议/2.数据链路层.html":{"url":"3.TCPIP协议/2.数据链路层.html","title":"2.数据链路层","keywords":"","body":"以太网：Ethernet 当今主导地位的局域网组网技术（只与物理层数据链路层有关） 以太网的发展史： 20世纪70年代，由Xerox公司联合Intel和DEC公司开发出以太网 1973年，传输速率3Mb/s 1980年，传输速率10Mb/s 1990年，出现双绞线介质的以太网 1992年，传输速率100Mb/s 1998年，传输速率1000Mb/s 2010年，IEEE发布40G/100G标准 2013年，400G的以太网标准工作正式启动！ 以太网的分类： 类型 支持速率/模式 需不需要冲突检测CSMA/CD技术 DIX以太网 10Mbit/S以太网 需要CSMA/CD IEEE802.3 10Mbit/S以太网 需要CSMA/CD IEEE802.3u 100Mbit/S以太网 可以选择使用CSMA/CD IEEE802.3z 1Gbit/S以太网 可以选择使用CSMA/CD IEEE802.3ae 10Gbit/S以太网 不需要CSMA/CD IEEE802.3ba 40/100Gbit/S以太网 不需要CSMA/CD IEEE802.3x 全双工 不需要CSMA/CD CSMA/CD载波侦听多路访问/冲突检测技术：用来避免在同一共享介质出现信号冲突的技术。 工作流程：发前先听，变发边听，冲突停发，计算后重发 数据链路层的分层设计： 在数据链路层定义了两个子层：LLC层和MAC层 LLC Logical link control 逻辑链路控制负责识别网络层的协议类型并对网络层的数据进行封装向下层传递 MAC Media access config 介质访问控制负责控制物理层设备处理硬件设备的物理寻址、定义网络拓扑及数据帧的传递顺序 以太网的帧结构： IEEE802.3是Ethernet的前生，目前基本未使用 Ethernet帧结构： 协议类型 代表上层的协议 （IP=00800 ARP=00806 IPv6=86DD ） 帧大小范围 64B~1518B MTU 最大传输单元，每次发送数据的最大值（默认为1500B，大于或小于该值的数据帧都有问题） 帧校验 通过一定的计算公式来对数据包的完整性检查 MAC地址 代表一个网络接口的物理地址，全球唯一 FCS帧校验序列 4B：用来检测数据的完整性，不完整的会被之间丢弃（不会重传，靠上层实现重传） 前24位是IEEE电气和电子工程师协会分配给厂商，后24位是厂商分配的用户 主机接收到数据帧的动作： 检测FCS，通过下一步（反则丢弃） 检测DMAC，通过交给上层（反则丢弃） 赣ICP备2023008387号-1 赣公网安备36052102100040号 Copyright ©2022 - 2024 By Feiyu最近一修改时间： 2025-04-09 21:19 "},"3.TCPIP协议/3.应用层概述.html":{"url":"3.TCPIP协议/3.应用层概述.html","title":"3.应用层概述","keywords":"","body":"应用层概述： TCP/IP模型的最高层 直接为应用程序提供网络服务 ​ 常用的应用层协议： DNS HTTP SMTP和POP3/IMAP Telnet和SSH FTP和TFTP DNS：Domain Name system 域名解析系统 （域名为了方便人们记忆） 建立IP地址与域名关系 将域名解析为IP地址 将IP地址解析为域名 每一次访问域名，都会向DNS服务器查询，DNS服务器进行响应，完成目的地址的封装 DNS大致分为请求报文request和响应报文relay 好用的DNS服务器：114.114.114.114 系统自带的DNS查询工具 命令 备注 nslookup 进行DNS查询 ipconfig /displayDNS 查看DNS缓存 ipconfig/flushDNS 清空DNS缓存 HTTP：hypertext transfer protocol 超文本传输协议 帮助客户端访问万维网 （World Wide Web） 网络浏览器通过翻译源代码（HTML超文本标识语言）文件来表示文本、图像、音乐、动作及视频 客户端首先发送get报文给服务器，请求将源代码发送 服务器将页面文件翻译文本、图像、音乐、动作及视频给客户端 HTTP不安全，抓包可以抓取到账号密码 SMTP和POP3：邮件服务 协议 备注 SMTP Simple mail transfer protocol 简单邮件传输协议用于发送邮件 POP3 Post office protocol v3 邮局协议版本3用于接收邮件 IMAP Internet massage access protocol 互联网邮件访问协议类似于POP3，功能更多 邮件绑定不成功，可能是邮件服务未开启 Telnet：terminal network 终端网络 远程管理的主要协议（网络设备、服务器、数据库等） 常用终端工具有：SecureCRT、Putty、Xshell Telnet 不安全，在抓包可以看到账号密码，现在多数使用SSH FTP和TFTP： 协议 备注 FTP File transfer protocol 文件传输协议提供可靠的文件传输服务具有认证、权限等功能 TFTP Trivial file transfer protocol 简单文件传输协议提供不可靠的文件传输服务消耗资源较小，速度较快常用于网络设备的配置文件和系统文件传输 赣ICP备2023008387号-1 赣公网安备36052102100040号 Copyright ©2022 - 2024 By Feiyu最近一修改时间： 2025-04-09 21:22 "},"4.路由/ACL.html":{"url":"4.路由/ACL.html","title":"ACL","keywords":"","body":" ACL：Access Control List 访问控制列表 （第一代防火墙） ACL工作原理：先细后粗 ACL由一条或多条规则组成 每条规则必须选择动作：允许permit或拒绝deny 每条规则都有一个id序列号（编号默认为5，间隔默认为5） 序列号越小越先进行匹配（规则序列号小的先匹配上后面的规则就不再进行匹配） 只要有一条规则和报文匹配，就停止查找，称为命中规则 查找完所有规则，如果没有符合条件的规则，称为未命中规则 ACL只是一个流量匹配规则，必须要应用在某个接口或其他技术内才会激活 应用在接口时必须选择方向：入站或出站 不能过滤由设备自己产生的流量 ACL类型：分为数字型ACL和命名ACL 数字式ACL：下列序号是比较熟悉的，对于高级的设备支持匹配的序号越多 分类 编号范围 匹配参数 基本ACLBasic access-list 2000~2999 源IP地址等 高级ACLAdvance access-list 3000~3999 源IP地址、目标IP地址、源端口、目标端口等 二层ACLSpecify a L2 acl group 4000~4999 源MAC地址、目标MAC地址、以太帧协议类型等 用户自定义ACLUser defined access-list 5000~5999 ipv4包头、ipv6包头、L2层包头、L4层包头等 命名式ACL：如果后面有名字默认就是高级ACL，如果名字后有数字那就根据数字编号来确定 例： acl name noweb（高级ACL，从3999开始倒叙编号） acl name nochat 2266（基本ACL） 正掩码、反掩码、通配符区别： 名称 规则 作用 举例 备注 正掩码 连续的1和0 IP地址 255.255.255.0 1对应网络位，0对应主机位 反掩码 连续的1和0 路由协议OSPF等 0.0.0.255 0必须匹配，1无须匹配 通配符 任意的1和0 ACL 0.0.255.0 0必须匹配，1无须匹配 举例 备注 192.168.0.1 0.0.0.0/0 匹配一个主机地址 192.168.0.0 0.0.0.255 匹配一个网段 192.168.0.1 0.0.0.254 匹配网段内奇数地址 192.168.0.0 0.0.0.254 匹配网段内偶数地址 x.x.x.x 255.255.255.255 匹配所有地址 ACL配置： 命令 配置 acl 2000 创建一个基本ACL rule 5 permit source 192.168.1.0 0.0.0.255rule 5 deny source 192.168.1.0 0.0.0.255 配置ACL的规则：允许或拒绝源地址为192.168.1.0/24网段内的所有流量 acl 3000 创建一个高级ACL rule 5permit/deny tcp source 192.168.1.0 0.0.0.255 destination 8.8.8.8 0 destination-port eq 80 eq 等于 gt 大于 lt 小于 range 范围 配置ACL的规则：允许或拒绝源地址为192.168.1.0/24网段内到8.8.8.8的http流量 traffic-filter inbound acl 2000traffic-filter outbound acl 2000 在接口上调用ACL过滤流量 display acl 2000 验证ACL2000 display traffic-filter applied-record 查看设备上所有基于ACL调用情况 ACL调用方向建议：基本在出接口，高级在内接口 基本ACL尽量调用在离目标最近的出站接口Outbound 高级ACL尽量调用在离源头最近的入站接口Inbound ACL的规则一般是先细后粗 赣ICP备2023008387号-1 赣公网安备36052102100040号 Copyright ©2022 - 2024 By Feiyu最近一修改时间： 2025-04-09 21:00 "},"4.路由/ARP.html":{"url":"4.路由/ARP.html","title":"ARP","keywords":"","body":"ARP address resolution protocol 地址解析协议 目的MAC不能不存在，负责完成不了封装，于是出现ARP ARP报文的类型分为request请求和reply/respond回应 ARP请求： ARP请求发送的类型为广播帧 （同一广播域的主机都会收到） ARP响应： ARP响应的类型为单播帧 （可以使用软件修改为广播-ARP欺骗） ARP缓存表：获取到的MAC地址会存放在该表 命令 备注 Arp -a 查看ARP缓存 Arp -d 清空ARP缓存 ARP欺骗：攻击者发送“无故ARP响应”来伪装其他设备 免费arp：用来检测配置/修改的IP地址是否重复 连续发送3次来检测地址有没有冲突 赣ICP备2023008387号-1 赣公网安备36052102100040号 Copyright ©2022 - 2024 By Feiyu最近一修改时间： 2025-04-09 21:00 "},"4.路由/DHCP.html":{"url":"4.路由/DHCP.html","title":"DHCP","keywords":"","body":" DHCP：Dynamic Host Configure Protocol 动态主机配置协议 从BOOTP（Bootstrap Protocol）协议发展而来 UDP封装，服务器使用端口67，客户端使用端口68 动态分配网络信息（IP地址、子网掩码、网关、DNS服务器等） 分配给客户端的网络信息是有租约的 DHCP系统组成： DHCP Cilent客户端 请求网络信息的用户 DHCP Server服务器 能够提供DHCP功能的设备 DHCP Relay中继 一般为路由器或三层交换机等设备 DHCP报文结构： 报文类型 备注 DHCP Discover 发现 客户端寻找DHCP服务器 DHCP Offer 提供 服务器响应DHCP Discover报文，该报文携带了各种配置信息 DHCP Request 请求 客户端请求服务器对网络信息确认或者续约租期 DHCP ACK 确认 服务器对DHCP Request报文确认响应 DHCP NAK 不确认 服务器对DHCP Request报文的拒接响应 DHCP Release 释放 客户端要释放地址时用来通知服务器 DHCP工作流程： 注：Office报文和ACK报文也可以是广播包，因为服务器只是根据Mac地址回应，根本没有看三层 （在ACK确认之后才是真正的使用地址） NAK报文出现： 1.IP地址可能已经被使用 2.租期未到网络信息还存在，换了DHCP服务器 （回家，请求续约，但是服务器根本不存在该网络信息） DHCP租期更新： 在租期时间过50%后，主机会自动发送DHCP Request报文请求DHCP服务器重新续租 DHCP重绑定： 在租期时间过50%一直请求服务器，但服务器未响应，客户端在87.5%会以广播的形式发送DHCP Request报文请求以获取IP地址。 （注：是以广播的形式发送） 无法获取到DHCP服务器分配的网络信息，Windows客户端会自动使用169.254.0.0/16地址，供临时通信 无法获取从DHCP服务器获取网络信息的排错： 1.检测物理链路，驱动….. 2.Windows的DHCP client服务未开启 3.手动配置地址，测试于DHCP服务器的连通性 租期设置建议： 释放DHCP服务器分配的网络信息： DHCP地址池（pool）：所分配地址的集合 地址池的分类：接口地址池和全局地址池 同时配置，接口地址池优先级比全局地址池高 DHCP配置： 命令 备注 dhcp enable 开启DHCP功能 interface G0/0/0 进入具体接口开始配置 dhcp selcet interface 创建DHCP接口模式地址池 dhcp server dns-list 114.114.114.114 223.5.5.5 配置接口地址池的DNS服务器地址（可以配置多个） dhcp server lease day 1 hour 12 配置接口地址池的租期，默认1天 dhcp server excluded-ip-address 192.168.10.100 配置接口地址池排除的地址 dhcp server static-bind-ip-address 192.168.10.100 mac-address xxxx.xxxx.xxxx 配置静态绑定 dhcp select globa 创建DHCP全局模式地址池 ip pool RoomA 创建全局地址池名称 network 192.168.10.0 mask 24 配置全局地址池可分配的网段地址 gateway-list 192.168.10.1 配置全局地址池的网关地址 dns-list 114.114.114.114 223.5.5.5 配置全局地址池的网关地址 lease day 1 hour 12 配置全局地址池下的租期，默认1天 excluded-ip-addess 192.168.10.111 配置全局地址池下的排除地址范围 dhcp select relay 关联接口开启中继代理 dhcp relay server-ip192.168.10.254 指定DHCP服务器的地址 display ip pool interface vlanif10 used 验证某接口地址池的信息 display ip pool name huawei used 验证全局地址池的信息 display ip pool [interface 接口名 all] 查看地址池的属性 ipconfig /release 释放租期 ipconfig /renew 重新获取 DHCP接口地址池配置： DHCP全局地址池配置： 赣ICP备2023008387号-1 赣公网安备36052102100040号 Copyright ©2022 - 2024 By Feiyu最近一修改时间： 2025-04-06 16:47 "},"4.路由/ICMP.html":{"url":"4.路由/ICMP.html","title":"ICMP","keywords":"","body":" ICMP：Internet control massage protocol 因特网控制协议：用于测试网络可达性、使用ping、tracert等命令调用 ICMP的格式： ICMP的类型： echo request 回响请求 echo reply 回响应答 Type 类型和 Code 代码的组合： 命令 备注 Ping 测试网络连通性 tracert 显示经过的路径 Ping 参数： tracert参数： Ping 常见问题： 成功 对方成功回响 超时 对方主机不在线、屏蔽 （不在线-有对方MAC地址缓存，对方可能关机，平并-对方开启了策略“如防火墙”） 传输失败 物理链路/网卡问题，网关未指定 无法访问 未获取到MAC地址，导致无法进行ICMP封装 赣ICP备2023008387号-1 赣公网安备36052102100040号 Copyright ©2022 - 2024 By Feiyu最近一修改时间： 2025-04-06 16:47 "},"4.路由/IP地址概述.html":{"url":"4.路由/IP地址概述.html","title":"IP地址概述","keywords":"","body":"IP地址：IP Address 在网络中，通信节点都需要有一个IP地址 以点分十进制表示，有32位二进制构成（大小约43亿） 分为两大部分：网络位和主机位 网络位，代表IP地址所属的网段 主机位，代表网点上的某个节点 由子网掩码决定 “分界点” 熟记： IP地址分类：IP地址分为A,B,C,D,E五类地址 能够被主机使用的地址：A,B,C “单播地址” 只能用作目的的地址：D “组播地址” A类：0~126 B类：128~191 C类：192~223 D类：224~239 E类：240~255 特殊用途的地址： 0.0.0.0 任意地址 用于配置默认路由 127.0.0.0 环回地址 用于测试本地的TCP/IP协议栈是否正常 169.254.0.0 微软分配的地址 用于在DHCP地址获取失败后使用的地址 255.255.255.255 广播地址 用于本网络所有节点 在IP地址中定义了两种地址：公网地址和私网地址 公有地址：用于Internet，向ISP付费申请的地址，全球唯一 私网地址：仅用于企业网络内部，不能用于Internet，免费使用，可以重复 公网地址直接访问Internet，私网地址不能直接访问Internet。 私网地址访问Internet，需要NAT地址转换协议，将私网地址转换成公网地址 私网地址 范围 10.0.0.0/8 10.0.0.0~10.255.255.255 172.16.0.0/16 172.16.255.255~172.31.255.255 192.168.0.0/24 192.168.0.0~192.168.255.255 子网掩码：subnet mask 用于区分网络地址和主机地址 1表示网络位，0表示主机位（连续） 地址的默认子网掩码： A类 /8 255.0.0.0 B类/16 255.255.0.0 C类 /24 255.255.255.0 每个网段上都有两个特殊地址（最大和最小）是不能够使用的：网络地址和广播地址 网络地址和广播地址： 网络地址、主机地址、广播地址： 网络地址 主机位全0代表一个网段（头） 主机地址 主机位不能全0或1代表网段内的一个节点 广播地址 主机位全1代表一个网段内的所有节点（尾） 可用主机地址：掐头去尾 （减去网络和广播） A,B,C类地址默认掩码 有类IP地址规划的缺陷：使用默认掩码的问题：地址范围过大或过小，导致IP地址的浪费 子网划分： 满足不同网络对IP地址的需求 实现网络的层次化 节省IP地址 默认子网掩码可以进一步划分，称为可边长子网掩码“VLSM” 向主机位借1位，可以划分出两个网络 公式： 赣ICP备2023008387号-1 赣公网安备36052102100040号 Copyright ©2022 - 2024 By Feiyu最近一修改时间： 2025-04-06 16:47 "},"4.路由/IP报文.html":{"url":"4.路由/IP报文.html","title":"IP报文","keywords":"","body":" IP：Internet protocol 因特网协议：网络层占主导地址协议：IP IP报文结构： 版本version：标明IP报文的版本（ v4 或 v6） 头部长度header length：头部长度（最小为20B，最大为60B） 总长度total length：头部长度和数据长度 分片：当数据包的大小超过数据链路层的MTU就需要分成多份数据包传输 分片之后重组依靠： 标志 identification 标识符 flags 片偏移 fragment offset 标志：用来标识同一个数据包 标识符： 保留 ：未使用 分段：置位表示不能分片 （遇到超过MTU的直接丢弃） 更多分段：置位标识还有分片（未置位表示这是最后一个分片） 片偏移：说明该数据包在重组后的位置 TTL：time to live 生存时间 （生命值） 防止数据包在网络中无休止的传递（防环） 每经过一次路由（路由转发）TTL值就会减1 当TTL值=0，丢弃数据包，并告诉源地址 利用TTL特性，可以实现路由跟踪技术，排错的重要方法之一 相关命令：ping -I 或 tracert tracert会一次发送3个igmp echo request报文 Protocol 协议：用来标识上层使用的协议 熟悉的协议号 协议号 1.ICMP 因特网控制报文协议 2.IGMP 因特网组报文协议 6.TCP 传输控制协议 17.UDP 用户数据报协议 41.IPV6 因特网v6 47.GRE 通用路由封装协议 89.OSPF 开放式最短路径优先 103.PIM 协议无关报文 112.VRRP 虚拟路由冗余协议 赣ICP备2023008387号-1 赣公网安备36052102100040号 Copyright ©2022 - 2024 By Feiyu最近一修改时间： 2025-04-06 16:47 "},"4.路由/NAT.html":{"url":"4.路由/NAT.html","title":"NAT","keywords":"","body":" 公网地址的由来：个人/企业——>ISP运营商——>CNNIC中国互联网络信息中心——>APNIC（Asia Pacific Network Information Centre）亚太地址网络信息中心——>IANA互联网数字分配机构 （早在2012年IP地址就已经分配完了） 没有NAT技术，私网地址数据可以出去，但是回不来（无回程路由） 私网地址不可能出现在公网上（太多私网地址重复，设备性能也不足以支持） NAT地址转换缓存表：记录转换地址信息 NAT好处： 有效避免了来自外网的攻击，大大提高了网络安全性 控制内外访问外网，同时也控制外网访问内网，解决了内网和外网通信的问题 家庭路由器和运营商路由器的区别： 记录NAT缓存需要消耗大量的内存，CPU，导致上网速度慢（待机数量） 带宽和包转发 NAT类型：NAT的实现方式有很多种，适用于不同的场景 静态NAT实现了私有地址和公有地址的一对一映射（一对一） 一个公网IP只会分配唯一固定的内网主机 如果希望一台主机专用某个公网地址，或者想要外网访问内网服务器时，可以使用静态NAT 静态NAT不能有效缓解公网地址短缺的问题 静态NAT配置： 命令 备注 nat static enable 开启NAT静态功能 nat static global 公网地址 inside 私网地址 创建静态NAT display nat static 验证静态NAT的配置 动态NAT 动态NAT基于地址池来实现私有地址和公有地址的转换（多对多） 动态NAT定义了地址池，规定一个范围的地址可以供主机转换 动态NAT地址池中的地址用尽后，只能等待被占用的地址被释放，其他主机才能使用它来访问公网 动态NAT也不能有效缓解公网地址短缺的问题 （使用ICMP时地址会变换，是没有端口的，但是有标识，可以根据标识来分辨） NAPT允许多个内部地址映射到同一个公有地址的不同端口（多对一） NAPT（Network Address Port Translation）也称为NAT-PT或PAT 网络地址端口转换 通常适用于大型企业网络（申请多个固定的公网地址） NAPT需要定义地址池，不能直接使用出接口的地址 有效的缓解了公网地址短缺的问题 动态NAT和PAT配置：（命令语句后不跟no-pat即为PAT模式，多对一） 命令 备注 nat address-group 编号 公网地址范围eg:nat address-group 1 12.0.0.50 12.0.0.100 配置NAT地址池 nat outbound acl 编号address-group 编号 [no-pat]eg: nat outbound 2000 address-group 1 no pat 关联一个ACL和一个NAT地址池（所以要先配置ACL的规则，允许哪些主机或网段可以上网）ACL用来匹配能够转换的源地址 no-pat 只转换地址而不转换端口 nat outbound acl 编号 address-group 编号 配置NAPT display nat address-group 查看NAT地址池配置信息 display nat outbound 查看动态NAT配置信息 display nat session all 查看所有NAT会话内容 Easy IP：以出接口公网IP地址作为NAT的地址（SNAT）源端口转换 直接使用出接口的地址做转换 Easy IP适用于小规模居于网中的主机访问Internet的场景 如：家庭、小型网吧、小型办公室中，这些地方内部主机不多，出接口可以通过拨号方式获取一个临时公网IP地址 有效的缓解了公网地址紧缺和不固定的公网地址转换问题 Easy IP 与NAPT的区别 Easy IP直接把内部地址映射到网关出口地址上的不同端口，直接使用公网端口进行转发 不需要像NAPT那样创建公网地址池，也不需要知道公网地址池是多少 Easy IP配置： 命令 备注 nat outbound acl 编号 配置Easy IP 关联出站接口和ACL NAT服务器=端口映射=目的端口转换（DNAT转换） 能够实现外网地址访问内网地址的方法：NAT、VPN NAT具有“屏蔽”内部主机的作用，但有时内网需要向外网提供服务 当外网用户访问内网服务器时，出口设备通过事先配置好的“公网IP地址+端口号”与“私网IP地址+端口号”间的映射关系，将服务器的“公网IP地址和端口号”根据映射关系替换成对应的“私网IP地址+端口号” NAT服务器的公网IP地址和端口中，端口可以更改，提供安全性 NAT服务器配置： 命令 备注 nat server protocol tcp/udpglobal 公网地址 端口 inside 私网地址 端口 配置NAT服务器 nat server protocol tcp global current-interface 端口 inside 私网地址 端口 如果提供的服务地址=出接口地址，需要打current-interface命令，不能打公网地址 display nat server 查看NAT服务器 赣ICP备2023008387号-1 赣公网安备36052102100040号 Copyright ©2022 - 2024 By Feiyu最近一修改时间： 2025-04-06 16:47 "},"4.路由/OSPF.html":{"url":"4.路由/OSPF.html","title":"OSPF","keywords":"","body":" OSPF概述：Open shortest path first 开放式最短路径优先 大中型网络使用最广泛的IGP协议 链路状态路由协议 无类别路由 使用组播（224.0.0.5和224.0.0.6） 收敛较快 以开销（Cost以接口带宽作为计算）作为度量值 采用SPF算法可以有效的避免环路 触发式更新（以较低频率 （每30分钟）定期发送更新，被称为链路状态泛洪） 设置区域概率使得OSPF能够支持更大规模的网络（划分骨干区域和非骨干区域和特殊区域） 通过LSA（链路状态信息）的形式发布路由 不支持自动汇总，支持手动汇总 （在ABR/ASBR上配置） OSPF区域概述： 术语 备注 区域（Area） 为了适应大型网络，OSPF在AS内划分多个区域区域是以接口为单位来划分每个OSPF路由器只维护所在区域的完整链路状态信息 区域ID（Area ID） 可以表示成一个十进制的数字，如：1也可以表示成一个IP，如：0.0.0.1 区域优点 尽量减少LSDB大小拓扑变化仅影响本区域内部 OSPF区域类型： 类型 备注 骨干区域 area 0骨干区域，也称为传输区域（负责在不同非骨干区域之间分发路由信息） 非骨干区域 area 0除外非骨干区域，称为末端区域 划分多区域的作用： 为了减轻运行OSPF路由器的压力 防环机制：划分了骨干区域和非骨干区域，所有非骨干区域通讯必须经过骨干区域中转 骨干区域传来的LSA不会再传回骨干区域 非骨干区域之间通信需要骨干区域转发（为了防止环路） OSPF路由器角色： 角色 备注 IR Internal Router 内部路由器所有接口都属于同一个区域 BR Backbone Router 骨干路由器至少有一个接口属于骨干区域 ABR Area Border Router 区域边界路由连接多个不同的区域，至少有一个接口属于骨干区域 ASBR Autonomous System Border Router自治系统边界路由器 将其他路由协议学习到的路由以引入的方式到OSPF进程中 PS 一台路由器可以同时属于多种类型 OSPF核心工作流程： 发现并建立邻居 传播LSA（区别基于距离矢量算法的路由表更新）LSA的内容 ： 1. Link State Advertisement 链路状态宣告（路况信息） 链路：路由器接口 状态：描述接口信息（地址、掩码、开销、网络类型、邻居关系等） 将LSA泛洪到区域中的所有OSPF路由器，而不仅是直连的路由 收集LSA创建LSDB（链路状态数据库、地图） 使用SPF算法计算到达每个目标网络的最短路径，存放于路由表 OSPF三张表： 类型 含义 邻居表dis ospf peer 记录所有邻居关系 链路状态数据库dis ospf lsdb 记录所有链路状态信息 路由表dis ip routing-table 记录最佳路由 Router ID： 运行OSPF协议前，必须选取的一个RID 用来唯一标识一台OSPF路由器（不能重复） RID可以手动配置，也可以自动生成 规则 备注 RID选取规则顺序 1.推荐手动配置（例：ospf 1 router-id 1.1.1.1这个RID可以和你的接口地址完全没有关系也可以配置成一样的地址)2.活动回环接口中选取IP地址最大的3.活动物理接口中选取IP地址最大的 注： 选取Router-ID时，先看回环口再看物理口 任何选举值都未配置是运行不了OSPF的（router id为0.0.0.0） 比较到物理接口中活动物理接口选取不出来，会选择非活动接口 RID选举具有非抢占性，除非重启OSPF进程 OSPF数据包的结构和类型：封装基于IP协议，协议号为89 OSPF数据包分为OSPF报头和OSPF数据部分： OSPF报头字段是固定的，OSPF数据包的内容由报头的类型决定 OSPF数据包的类型（5种类型）： OSPF数据包 作用 Hello 建立并维护邻居关系 Database Description （DD）比较数据库，只在邻居建立时发送 LSDB的摘要信息（仅包含LSA头部） Link State Request（LSR） 请求LSA Link State Update （LSU） 发送LSA （完整的LSA信息） Link State Acknowledge （LSAck） 对LSU的确认 （OSPF的确认机制） OSPF状态机制（7种状态）：下图有8种状态，Attempt状态只在帧中继中有用，暂不考虑 阶段 状态 备注 第一阶段 失效状态（Down） 没有收到Hello包 第一阶段 初始状态（Init） 收到了Hello包，但是邻居列表里没我 第一阶段 双向通信状态（Two-Way） 收到了Hello包，且看到自己，形成邻居关系 交换初始状态（Exstart） 决定信息交换时的路由器主从关系 交互状态（Exchange） 向邻居发送DD数据包 加载状态（Loading） LSR和LSU交互阶段（互发LSA信息） 完全邻接状态（Full） LSDB同步完成，形成邻接关系 注：只有Two-Way和Full是稳定状态 OSPF工作流程（数据包和状态切换过程）： OSPF第一阶段：使用Hello包建立双向通信的过程，成为邻居关系。 OSPF第二阶段：通过交换LSA达到LSDB同步，建立邻接关系 Exstart：Seq序列号x，I=1表示是第一个发送的DD包，M=1表示后面还有DD包，MS=1表示我是主（初始都是主） 通过比较Router ID值大的一方为主，向主发送的DD报文中序列号会变成主的序列号，同时这才是真正的DD报文 Seq序列号y+n表示经过比较RID后较大的序列号建立了邻居，MS=1表示我是主，此处由R2先向你发送LSDB链路状态数据库摘要，R1收到后向R2反馈R1自己的LSDB摘要，使R2先达到Full状态；R2至此建立了完整的LSA，向R1发送LSU链路状态更新，R1收到后发送LSAck确认信息，R1至此也达到Full状态。 注： 确认主从的作用是为了LSDB同步可靠 同一区域内的路由器中LSDB链路状态数据库必须是一致的，但是每个路由器的路由表和邻居表是不一样的 OSPF邻居建立条件：必须三层直连 建立邻居需要检验的字段： RID唯一（不能重复） 发送Hello包和邻居失效时间一致 区域ID一致 认证一致 链路MTU大小一致（华为默认不开启，思科默认开启） 子网掩码一致、网络地址一致 （以太网组网环境） 末梢区域设置一致 （Option字段） OSPF网络类型：推出时间较早，为了支持不同的链路，而设计了网络类型 OSPF网络类型：基于接口 广播网络类型（BMA） 点到点网络类型(P2P) 非广播多路访问类型(NBMA) 点到多点网络类型(P2MP) 判断网络类型基于接口 （在BMA网络中，每一个网段选取一个DR,BDR） 类型 备注 广播类型 BMA 通过以太网接口连接设备，支持广播和组播 点到点P2P 通过串行接口连接设备，支持广播和组播 非广播多路访问NBMA 早期使用帧中继，ATM组网的设备，不支持广播和组播 点到多点 P2MP 多个点到点的集合，没有一种链路层协议会被缺省的认为是P2MP类型。点到多点必须是由其他的网络类型强制更改的。 DR和BDR： 只要是多路访问BMA和NBMA网络中，为了减少邻接关系的数量，从而减少数据包的交换次数，最终节省带宽，降低路由器的处理压力，选举DR和BDR 术语 备注 DR Designed Router 指定路由器 ，类似于班长、总经理 BDR Backup Designed Router 指定备份路由器，DR的备份，类似于副班长、副总经理 DRothers 路由器，类似于普通学生 关系 DR、BDR、DRothers之间都保持邻接关系 （Full）DRthers之间都保持邻居关系（Two-Way） 地址 224.0.0.6向DR和BDR发送 （LSA包）224.0.0.5向所有OSPF路由器发送 （Hello包） 选举规则 首先比较Hello报文中携带的优先级优先级范围0~255，默认为1优先级最高的被选举为DR，优先级次高的被选举为BDR优先级为0不参与选举优先级一致，比较RID，越大越优先选举具有非抢占性（选举完成后出现更好的OSPF路由器不会强占角色） 实验演示：当前AR1是DR，AR2是BDR R1（DR）和R3、R4,R2（BDR）和R3、R4是Full的关系，R3（DRothers）和R4（DRothers）是Two-way的关系 重新选举DR和BDR使用的命令 LSDB同步过程：DR和BDR会接收224.0.0.6的LSU监听信号和LSack确认信号，（DRthers的路由器链路状态一但发生改变会直接通过224.0.0.6发送组播LSU给DR和BDR） DR收到LSU更新，会使用224.0.0.5组播泛洪到所有路由器 OSPF度量值：Cost 开销 在每一个运行OSPF的接口上，都维护着一个接口Cost 公式：Cost=10^8次方/带宽（bps）=100Mbps/BW=接口参考值/接口带宽（cost最小为1，没有小数） 到一个目标网络的度量值 从源到目标的所有出站接口的 Cost值累加（数据方向） 从目标到源沿途所有的入站接口的Cost值累加（路由方向） 注：华为的回环口的开销默认是0，思科的回环口开销默认是1 OSPF配置： 命令 备注 ospf 1 router-id 1.1.1.1 开启OSPF，进程号默认为1，手动配置RID area 0/0.0.0.0 配置区域 network 192.168.0.0 0.0.0.255 宣告网络，即指定运行OSPF的接口；使用反掩码来匹配（255.255.255.255减去掩码得到的值） authentication-mode md5/simple 设置认证，明文或密文 default -route-advertise 发布默认路由 display ospf peer （brief） 显示OSPF邻居信息 ospf timer Hello 10 修改Hello包的发送时间 ospf timer dead 40 修改Hello包的超时时间 display ospf interface g0/0/0 显示OSPF接口信息 ospf dr-priority 10 修改OSPF接口优先级，范围0~2550为不参与选举，255为必参与选举 ospf cost 10 修改开销，范围1~65535，缺省值为1 bandwidth-reference 100 修改开销计算的参考值，默认为100Mbps（修改公式中的分子）最好在整个OSPF网络中统一修改 reset ospf process number 重启OSPF进程，默认为1 ospf 1 enable area 0 在接口开启OSPF功能 default-route-advertise OSPF缺省路由发布命令 int g0/0/0 ospf authentication-mode md5 1 cipher password 配置接口认证如果同时配置，接口认证优先生效 ospf 1 area 0 authentication-mode md5 1 cipher password 配置区域认证 OSPF缺省路由发布：default-route-advertise 在出口的路由器上发布一条缺省路由，让内部的其他路由器动态学习 OSPF认证：基于接口区域 OSPF认证命令： 命令 备注 int g0/0/0 ospf authentication-mode md5 1 cipher password 配置接口认证 ospf 1 area 0 authentication-mode md5 1 cipher password 配置区域认证 PS：如果同时配置，接口认证优先生效 赣ICP备2023008387号-1 赣公网安备36052102100040号 Copyright ©2022 - 2024 By Feiyu最近一修改时间： 2025-04-06 16:47 "},"4.路由/RIP.html":{"url":"4.路由/RIP.html","title":"RIP","keywords":"","body":" RIP：routing information protocol 路由信息协议 距离矢量路由协议，属于IGP协议 适合中小企业网络，有RIPv1和RIPv2、RIPv3版本 基于UDP，端口号520 周期性（25.5~30.0/次）更新 支持水平分割、毒性反转和触发更新等防环机制 RIP把跳数作为度量值来衡量到达目的网络的距离 缺省情况下，直连网络的路由跳数为0，当路由器发送路由更新时，会将度量值加1 RIP规定超过15跳为网络不可达 RIP报文类型：请求request 和 回应response 请求报文：建立邻居后请求对方的路由信息 回应报文：回应对方的请求 每周期30/s次 RIPv1和RIPv2的区别： 版本 区别 RIPv1 有类别路由协议不支持VLSM,CIDR以广播的形式发送报文不支持认证 RIPv2 无类别路由协议支持VLSM，CIDR支持以广播或者组播（224.0.0.9）方式发送报文支持明文认证和MD5认证 RIPv1与RIPv2报文格式： 命令：值为1表示请求，值为2表示回应 版本：表明使用的版本 协议簇：TCP/IP协议该字段为2 RIP解决环路的方式：触发更新和水平分割、毒性反转 类型 含义 触发更新： 网络存在变化立即通知邻居 水平分割： 从邻居收到的路由信息不会在转发回去 毒性反转： 从邻居收到的路由信息会转发回去，但跳数置为16 水平分割和毒性反转时不能同时使用 默认使用水平分割，如果水平分割和毒性反转都存在则毒性反转生效 同时存在多个网段，但只想一个接口生效： 如果接口配置了input或output，静默生效 命令 备注 Rip 1 开启RIP进程，默认进程为1 Version 2 开启RIPv2版本 Network 10.0.0.0 宣告网络，将该IP地址的接口开启RIP功能 Rip metricin 5 设置接口接收路由增加度量值 Rip metricout 5 设置接口发送路由修改度量值 Rip split-horizon 开启水平分割，默认开启 Rip poison-reverse 开启毒性反转，默认关闭 Undo rip input 禁止接口接收RIP数据包 Undo rip output 禁止接口发送RIP数据包 slient-interface g0/0/0 配置被动接口，只收不发 赣ICP备2023008387号-1 赣公网安备36052102100040号 Copyright ©2022 - 2024 By Feiyu最近一修改时间： 2025-04-06 16:47 "},"4.路由/动态路由概述.html":{"url":"4.路由/动态路由概述.html","title":"动态路由概述","keywords":"","body":"静态路由与动态路由的比较： 协议 备注 静态 不能及时根据网络变化而自适应 动态 及时根据网络变化而自适应 路由协议概述： 路由器之间交互的一种语言 共享路由信息 维护路由器、提供最佳转发路径 路由协议总览： 类型 距离矢量协议 结合版 链路状态协议 路径矢量协议 有类 RIPv1 IGRP EGP 无类 RIPv2 EIGRP OSPFv2 ISIS BGPv4 IPv6 RIPng EIGRP for IPv6 OSPFv3 ISIS for IPv6 BGPv4 for BGPv6 路由协议分类：根据作用范围 类型 备注 IGP 内部网关协议（Interior gateway protocol） 用于一个AS内部交互路由信息常用协议：RIP、OSPF、ISIS、EIGRP EGP 外部网关路由协议（Exterior gateway protocol） 用于不同AS之间交互路由信息常用协议:BGP AS（autonomous system）：处于同一管理机构下的网络（如：企业、电信、移动、联通） IGP和EGP的区别： 类型 区别 IGP 路由器相互信任 （同一管理机构）路由数量较少注重发现路由，不需要什么策略 EGP 路由器并非相互信任 （不同管理机构）路由数量庞大注重于引入路由，策略丰富 路由协议分类：根据协议算法 类型 备注 DV 距离矢量（distance-vector） 基于距离矢量算法，路由器并不了解网络拓扑信息交互路由信息都会修改原始参数 （类似路旁，道听途说）如：RIP、EIGRP LS 链路状态 （link-state） 基于SPF算法（shortest path first 最短路径优先），路由器了解完整的网络交互路由信息直接传递不会修改原始参数（类似地图，完整）如：OSPF、ISIS 根据链路带宽来选择路由 路由协议分类：根据发送的更新是否携带掩码 类型 备注 Classful有类 不携带掩码如：RIPv1、IGRP、EGP clasless无类 携带掩码如：RIPv2、EIGRP、OSPF、BGP 不携带掩码：默认的路由掩码都是默认的，影响路由选路 路由协议分类：根据业务应用 类型 备注 Unicast routing protocol单播路由协议 如：RIP、EIGRP、OSPF、BGP、ISIS Multicast routing protocol组播路由协议 如：DVMRP、PIM-SM、PIM-DM 路由协议配置规则： 协议是在接口运行的 （需要宣告接口的IP地址/接口开启协议） 只能学习和发布运行相同协议的路由信息（不同路由协议之间互不干扰） 不同路由协议之间需要交互路由信息，需要进行引入/注入（Import） 注：引入必须要同时运行多个协议的路由器做中间人/代理 路由器收敛： 当所有路由表的信息都有一致的网络可达信息（相同的目的地址） 网络（路由）进入一个稳定状态 网络在达到收敛前无法完全正常工作 选择/衡量动态路由协议的一些性能指标： 指标 备注 正确性 能够正确的找到最优且无环的路由 收敛快 当网络发生变化后，能够快速做出响应 低开销 协议自身的开销（占用内存、CPU、带宽） 安全性 协议具有安全机制 普适度 适合各种拓扑结构和各种规模的网络 赣ICP备2023008387号-1 赣公网安备36052102100040号 Copyright ©2022 - 2024 By Feiyu最近一修改时间： 2025-04-06 16:47 "},"4.路由/单播、组播、广播.html":{"url":"4.路由/单播、组播、广播.html","title":"单播、组播、广播","keywords":"","body":"根据目标地址判断 类型 备注 单播 Unicast 发送给单个设备（明确目标地址） 广播 Broadcast 发送给所属广播域内的所有设备（目标地址不明确） MAC地址全F，IP地址全1 组播 Multicast 发送给一组目标MAC地址为01-00-5e，IP地址为D类 接收规则： 如果是单播帧，会比较目的MAC是否一致 如果是广播帧，会接收处理 （收到了不一定会回复） 组播只会给需要该数据的设备 冲突与广播： 冲突 Collision多个设备如果连接都一个传输信道上，发生的冲撞会导致信号不完整只会发生在早期使用使用集线器组网的共享式网络中 冲突域 Collision domain能够产生冲突的设备的范围 广播 Broadcast发送给所有设备 广播域 Broadcast domain能够收到广播的设备的范围 集线器 HUB不能分割冲突域和广播域 （所有接口都属于一个冲突域和广播域） 交换机 Switch 能够分割冲突域不能分割广播域（每个接口都是单独的冲突域） 路由器 Router能够分割冲突域和广播域（每个接口都是一个广播域） 集线器/信号复制器 HUB ：早期组网使用的设备 交换机 Switch ：重要的组网设备 路由器Router： 赣ICP备2023008387号-1 赣公网安备36052102100040号 Copyright ©2022 - 2024 By Feiyu最近一修改时间： 2025-04-09 21:00 "},"4.路由/网关及数据转发过程.html":{"url":"4.路由/网关及数据转发过程.html","title":"网关及数据转发过程","keywords":"","body":" 网关：Gateway 位于不同网络之间的主机需要通信，必须将数据包交给网关 （默认路由） 网关是一台具备路由功能的设备（路由器、三层交换机、防火墙、服务器） 网关地址与设备的接口地址是处于同个网络 主机经过与计算得出目的地址是否在同个网段同一个网段直接封装目的的MAC转发不同网段封装网关的MAC，网关帮忙转发 数据包转发的过程中IP地址和MAC地址：在同一个网段内的源MAC地址是不会变化，非同一个网段的源MAC地址会变化、IP地址一般不会变化，除使用NAT技术 数据转发过程： 主机A访问HTTP服务器 目的端口号：80 封装源IP目的IP地址，并进行与计算 不在同一网段，交给网关 检查缓存表是否有网关的MAC，没有进行ARP请求 最终以光信号、电信号发送出去 网关收到，进行FCS帧校验检测，通过检测目的MAC地址是否是我，通过交给网络层 发现目的IP地址不是我，查找路由表、封装新的二层帧头和帧尾，并进行转发 路由器以服务器A的MAC地址作为目的MAC地址继续转发 服务器A收到，进行FCS检测，通过检测目的MAC是我的MAC，继续交给上层处理 检测目的IP地址是我，检测协议号为TCP，交给TCP TCP检测目的端口交给HTTP 赣ICP备2023008387号-1 赣公网安备36052102100040号 Copyright ©2022 - 2024 By Feiyu最近一修改时间： 2025-04-06 16:47 "},"4.路由/路由基础.html":{"url":"4.路由/路由基础.html","title":"路由基础","keywords":"","body":" 常用名词： 术语 备注 路由routing 从源地址到目的地址不同网络间的转发过程 路由表routing table 路由信息的集合 路由的依据 路由器 router 具有路由功能的设备 默认网关default gateway 通过是路由设备的接口IP地址 路由过程图解： 路由器收到数据包检测路由表中是否存在能够去往目的IP地址、转发过程中是逐跳转发“并不会引导其他路由器转发”、数据通信是”双向性“ 路由表只是转发的依据，真正转发的是根据接口 “知道从哪里发送” 下一跳是路由器需要将该数据包交给谁来转发 路由协议分为动态协议和静态协议 静态的配置简单，不占用资源 动态协议配置相对复杂，可以及时同步网络变化 IP路由表：存放最优的路由信息/条目 路由表包含了可以去往的目的网络 ，路由器收到目的网络不存在的会直接丢弃 路由表字段 备注 Destination目标地址 用来标识存在的能够去往的目的地址或目的网络 Mask掩码 用来选择最佳路由的重要依据（最长匹配原则） NextHop下一跳 指明该数据包所经过的下一个路由器的接口地址 Interface出接口 指明该数据包将从哪个接口转发 Protocol 协议 路由的来源（学习方式） Preference优先级 用来比较不同协议学习去往相同地址不同路径的优先程度（越小越优先） cost开销 用来比较相同协议学习去往相同地址不同路径的的代价（越小越优先） 不同协议比较 路由协议/类型 Direct OSPF ISIS Static RIP OSPF ASE BGP 管理距离/优先级 0 10 15 60 100 150 255 相同协议比较 等价路由（ECMP，Equal cost multi-Path）： 对于一个路由来源，当到同一个目标网络存在多条相同度量值的路由时，路由器会将这些路由条目都加入路由表，数据包会在这几个链路（路径）进行负载分担。 （负载均衡的选择：逐包，逐流 可以根据目标IP或源IP，目标MAC或源MAC选择。最终会经过“哈希”计算实现） 最长掩码匹配原则：最终数据包实现最佳路由的算法 赣ICP备2023008387号-1 赣公网安备36052102100040号 Copyright ©2022 - 2024 By Feiyu最近一修改时间： 2025-04-09 21:00 "},"4.路由/静态路由.html":{"url":"4.路由/静态路由.html","title":"静态路由","keywords":"","body":" 技术背景：如果只有直连路由，那么非直连网络就无法到达 静态路由概述： 配置简单、开销小 通过手动配置进行添加和维护 无法根据拓扑的变化而自适应 适合于组网规模较小的场景，在大型网络环境，则配置及维护成本很高 在大型网络中，往往采用动、静态路由结合的方式部署网络 静态路由配置命令： 命令 备注 Ip route-static 目标网络 子网掩码/前缀 下一跳/出接口 配置静态路由 实现流量负载分担，提高链路利用率 优先级高的为活跃，优先级低的为非活跃 主链路故障，备份链路激活 缺省路由（网关）：一种特殊的路由，能匹配所有目标网络 赣ICP备2023008387号-1 赣公网安备36052102100040号 Copyright ©2022 - 2024 By Feiyu最近一修改时间： 2025-04-06 16:47 "},"5.交换/GARP-GVRP.html":{"url":"5.交换/GARP-GVRP.html","title":"GARP GVRP","keywords":"","body":" GARP:Generic Attribute Regisration Protocol 通用属性注册协议 在交换机间分发、传播、注册某种信息（VLAN属性、组播地址等） 主要用于大中型企业网络中，用来提升管理交换机的效率 一种协议规范 GARP消息类型: 类型 备注 Join 加入，端口加入VLAN Leave 注销，端口退出VLAN Leave All 注销所有 GVRP：GARP VLAN Registration Protocol，VLAN注册协议 GVRP基于GARP的工作机制，是GARP的一种应用，传递VLAN信息 VLAN分为常规（静态）和动态VLAN GVRP的结构： 工作于数据链路层 使用组播地址01：80：c2：00：00：21 GVRP的应用： 接收来自其他交换机的VLAN注册信息，并动态的更新本地的VLAN信息同步 将本地的VLAN注册信息向其他交换机传播，以便同一交换网内所有支持GVRP的设备VLAN信息同步 手动配置的VLAN是静态VLAN，通过GVRP创建的VLAN是动态VLAN GVRP传播的VLAN注册信息包括静态创建的VLAN信息和动态学习的VLAN信息 收到VLAN注册信息会将端口进行绑定，分发的端口不会进行绑定 GVRP注册模式：3种 Normal正常模式：允许静态和动态VLAN注册，同时会发送静态VLAN和动态VLAN的声明消息。 Forbidden禁止模式：不会接收动态VLAN注册，同时删除所有学习到的VLAN （只剩VLAN1）。 Fixed固定模式：不会发送和接收动态的注册信息，只会发送静态注册消息。 GVRP配置： 命令 配置 gvrp 全局开启GVRP，默认关闭 int g0/0/1gvrp 接口开启GVRP，接口类型必须是Trunk gvrp registration fixedgvrp registration forbiddengvrp registration normal 配置GVRP注册模式 display gvrp status 查看GVRP状态 赣ICP备2023008387号-1 赣公网安备36052102100040号 Copyright ©2022 - 2024 By Feiyu最近一修改时间： 2025-04-09 21:13 "},"5.交换/PPP.html":{"url":"5.交换/PPP.html","title":"PPP","keywords":"","body":" HDLC 可以租用接口地址来节省IP地址，同时可以批量修改端口地址PPP 名称 认证 错误检测 错误恢复 支持同步或异步链路 HDLC × √ × × PPP √ √ √ √ PPP组件 名称 作用 上层 NCP网络层控制协议Network Control Protocol 用于对不同的网络层协议进行连接建立和参数协商 下层 LCP链路控制协议Link Control Protocol 用于建立、拆除和监控PPP数据链路以及认证 PPP认证模式：PAP和CHAP 模式 备注 PAP（发明文密码） Password authentication protocol，密码认证协议 ，以明文方式直接放送密码，二次握手机制，发起方为被认证方缺点：以明文的形式发送密码不安全因为发送方为被任正非所以可以无限次的尝试（暴力破解）只在链路建立的阶段认证，一旦成功建立后将不在认证 CHAP（发暗号） Challenge Handshake Authentication Protocol，挑战/质询握手认证议，以MD5来隐藏密码，三次握手机制，发起方为认证方，有效避免了暴力破解，在链路建立后具有再次认证检测机制，目前使用的广泛 PPP认证配置： 命令 备注 aaa local-user huawei password cipher 123.com local-user huawei service-type ppp 配置PPP，设置用户名、密码和服务类型 ppp authentication-mode PAP 或ppp authentication-mode CHAP 开启PAP或CHAP认证（认证方配的） ppp pap local-user huawei password cipher 123.com 配置PAP认证（被认证方配的） ppp chap user huaweippp chap password cipher 123.com 配置CHAP认证（被认证方配的） 注： 只配置一方的用户名和密码，另一方开启认证的，这种为单向认证。 ======= HDLC 可以租用接口地址来节省IP地址，同时可以批量修改端口地址 PPP 名称 认证 错误检测 错误恢复 支持同步或异步链路 HDLC × √ × × PPP √ √ √ √ PPP组件 名称 作用 上层 NCP网络层控制协议Network Control Protocol 用于对不同的网络层协议进行连接建立和参数协商 下层 LCP链路控制协议Link Control Protocol 用于建立、拆除和监控PPP数据链路以及认证 PPP认证模式：PAP和CHAP 模式 备注 PAP（发明文密码） Password authentication protocol，密码认证协议 ，以明文方式直接放送密码，二次握手机制，发起方为被认证方缺点：以明文的形式发送密码不安全因为发送方为被任正非所以可以无限次的尝试（暴力破解）只在链路建立的阶段认证，一旦成功建立后将不在认证 CHAP（发暗号） Challenge Handshake Authentication Protocol，挑战/质询握手认证议，以MD5来隐藏密码，三次握手机制，发起方为认证方，有效避免了暴力破解，在链路建立后具有再次认证检测机制，目前使用的广泛 PPP认证配置： 命令 备注 aaa local-user huawei password cipher 123.com local-user huawei service-type ppp 配置PPP，设置用户名、密码和服务类型 ppp authentication-mode PAP 或ppp authentication-mode CHAP 开启PAP或CHAP认证（认证方配的） ppp pap local-user huawei password cipher 123.com 配置PAP认证（被认证方配的） ppp chap user huaweippp chap password cipher 123.com 配置CHAP认证（被认证方配的） 注： 只配置一方的用户名和密码，另一方开启认证的，这种为单向认证。 两边都配置用户名和密码，同时开启认证模式，互相发送认证信息，这种为双向认证。 赣ICP备2023008387号-1 赣公网安备36052102100040号 Copyright ©2022 - 2024 By Feiyu最近一修改时间： 2025-04-09 21:13 "},"5.交换/STP.html":{"url":"5.交换/STP.html","title":"STP","keywords":"","body":"STP生成树协议 STP的背景：为了实现二层设备（Ethernet协议）之间的可靠性，企业网络通常拿多台设备或链路实现链路冗余备份，会引起环路 二层网络设计的需求和问题： 为了提高可靠性，交换机之间会通过多条链路相连，从而避免单点故障。 但也会带来一些致命的环路问题。 环路问题给用户带来的后果：网络体验差、延迟高、丢包 环路引起的问题： 极大占用链路带宽资源和设备资源，造成大量的垃圾流量 网络广播风暴 MAC地址表项不稳定 重复的帧拷贝 STP：Spanning Tree Protocol生成树协议 提供两大功能： 功能 备注 消除环路 通过阻断冗余链路来消除网络中可能存在的环路 链路备份 当正常工作的链路出现问题，激活备份链路，及时恢复网络连通性 STP操作：通过构建一颗无环的树来消除网络中的环路。 BPDU：Bridge Protocol Data Unit - 桥协议数据单元 使用组播地址：01-80-C2-00-00-00 PID：STP的ID（无论是STP、RSTP、MSTP都是STP） PVI：标识使用的是什么模式（STP、RSTP、MSTP）华为默认的模式是RSTP BPDU 类型： 配置BPDU：Configuration 选举根交换机以及确定每个交换机的角色和状态。 在初始过程中，每个桥都主动发送配置BPDU。 在网络拓扑稳定后，只有根桥主动发送配置BPDU，其他交换机在收到上游传来的配置BPDU后，才会发送自己的配置BPDU。 发送周期为Hello Time。 老化时间为Max Age。 拓扑变更通告BPDU：TCN BPDU 下游交换机感知到拓扑变化时向上游发送的拓扑变化通知。 配置BPDU： 拓扑变更通知BPDU： BPDU字段详解： 选举桥角色和端口状态靠该4个字段 参数 描述 Root ldentifier根桥ID 发送此配置BPDU的交换机所认为的根交换机的标识 Root Path Cost根路径开销 从接收此根桥的配置BPDU的交换机到达根交换机的最短路径总开销（我到根桥有多远） Bridge identifier桥ID 标识自己的BID Port Identifier端口ID 发送此配置BPDU的交换机端口的端口标识 桥ID具体示意 从高位比较再到低位；值越小越优先。（选值4096的倍数） 端口ID具体示意 从高位比较再到低位；值越小越优先（端口编号与实际接口无关，选值16的倍数） 路径开销示意 （98年制定的旧链路开销标准，现在链路的带宽都不止10G，在计算带宽时存在不合理） （华为设备现在所支持的链路开销标准802.1t，使用链路聚合的开销=开销标准/链路数量） 根路径开销示意（由路径开销计算出根路径开销,根桥发出的BPDU开销为0) （从根桥发出的开销为0，在根据自己所有收到的接口到根桥的开销相加，取最小的开销值，就是根路径开销） STP选举过程：（在STP中优先级是越小越好） BID最小的成为根桥（先比较优先级再比较交换机Mac地址） （开始都会发送BPDU，在收到与自己的参数比较，然后清楚自己的角色） （先看RPC再看对端BID，然后比较对端PID，最后比较本地PID） （在每条链路上选举一个指定端口负责数据的收发，“根路径开销”是比较端口的RPC越小越好，所以根桥的端口都是0，为指定端口//当拿一根线插在同一个根桥时，根桥的端口会比较到PID，就不会都是指定端口，其中一个为预备端口状态变成阻塞） 剩下的端口就是预备端口状态为阻塞 STP的端口状态： STP端口状态 接收BPDU 转发BPDU 学习MAC 转发数据 过渡状态 稳定状态 Disabled禁用 × × × × × √ Blocking阻塞 √ × × × × √ Listening监听 √ √ × × √ × Learning学习 √ √ √ × √ × Forwarding转发 √ √ √ √ × √ 1.禁用 disable 未开启STP协议 2.阻塞 blocking 接收BPDU 3.侦听 listening 接收BPDU 转发BPDU 4.学习 learning 接收BPDU 转发BPDU 学习MAC地址 5.转发 forwarding 接收BPDU 转发BPDU 学习MAC地址 转发用户流量 注：华为交换机默认显示RSTP状态，附RSTP状态与STP端口状态对比 STP的计数器： 计时器 备注 Hello 2s，根桥发送BPDU的间隔 Forwarding Delay转发延时 15s，监听和学习的持续实际（监听到学习需要15S，学习到转发需要15s） MSG Age 当前的年龄，每经过一个设备就加1（从根桥开始为0往下算），最大为20，超过20则丢弃.（不建议接太多设备影响交换机性能） Max Age 20s，保持阻塞的最大时间（每2秒收到一次，通过比较最后阻塞，若20秒没收到就不再阻塞） 一个预备端口从阻塞状态到转发状态的时间：50S MSG Age STP的端口状态转换： STP拓扑变化： 根桥故障需要等待50S，网络才会恢复正常（20S老化时间和30S变成转发状态） （SWB检测到自己的根端口与根桥断了，立马将预备端口从阻塞状态变成转发状态，需要经过2个forwarding delay阻塞——15s监听——15s转发）这个过程需要30s （当SWB发生设备故障后，会发出我是根桥的BPDU，SWC收到2个对端发来的BPDU经过比较发现并不是最优的，接收但不会改变该角色，等到老化时间才会改变角色状态）这个过程需要50s 拓扑改变导致MAC地址表错误 MAC地址表老化太长，链路角色变换，但是MAC地址还是原来（要么等待300S或ARP老化） 解决方法： 检测到拓扑变化的交换机通过根端口向根桥发TCN，步骤1 上游交换机收到TCN后回应TCA，让下游交换机停止发送TCN，步骤2 再通过根端口发送TCN直到根桥收到，步骤3 根桥通过指定端口发送TC通知所有下游交换机把MAC地址表的老化时间300秒变成15秒。步骤4，5 BPDU字段中的Flags中： 1000 0000最高位为1作为TCA 0000 0001最低位为1作为TC STP的配置 命令 备注 stp mode {mstp \\ stp \\ rstp} 调整STP的模式，默认MSTP stp priority 4096 调整BID优先级值，0~61440，步长为4096的倍数 stp root primary / secondary 自动修改优先级，指定主/备根桥 stp pathcost-standard{ dot1d-1998 \\ dot1t \\ legacy } 配置计算路径开销值得标准 开销标准： legacy标准：cost=1~200000，华为私有802.1d标准：cost=1~65535802.1t标准：cost=1~200000000，默认 stp cost 10 修改STP开销 stp port priority 144 修改PID优先级，0~240，步长为16的倍数 赣ICP备2023008387号-1 赣公网安备36052102100040号 Copyright ©2022 - 2024 By Feiyu最近一修改时间： 2025-04-09 21:16 "},"5.交换/VLAN.html":{"url":"5.交换/VLAN.html","title":"VLAN","keywords":"","body":" VLAN技术背景： 划分VLAN，将广播域范围减小 VLAN优点： 有效控制广播域范围 增强局域网的安全性 灵活构建虚拟工作组 简化网络管理 VLAN概述：Virtual LAN 虚拟局域网 将一个物理局域网在逻辑上划分成多个广播域 1 VLAN = 1 广播域 = 1 子网 （划分最好一个子网一个VLAN） 广播不会在不同VLAN间转发，而是限制在相同的VLAN中 不同VLAN间的设备默认无法通信 VLAN范围：0~4095 （0和4095保留，1为默认） VLAN划分：基于端口最常见 VLAN标签介绍： IEEE 802.1q：又称dot1q，是VLAN的正式标准，对Ethernet帧格式进行修改，在源Mac地址字段和协议类型字段中插入了4字节的802.1q Tag 每台支持802.1q协议的交换机发送的数据帧都会包含VLAN ID，以指明数据帧属于哪一个VLAN。因此，在一个VLAN交换网络中，以太网帧有以下两种格式 无标记帧（untagged frame） 原始的数据帧，未加入4字节802.1q tag的字段 有标记帧（tagged frame） 插入了4字节802.1q tag的字段 路由器和终端设备发送的数据帧默认是untagged frame，默认也识别不了tagged frame VLAN链路类型： 类型 备注 Access Link 接入链路 一般用于连接主机或路由器之间的链路接入链路上传输的帧都是untagged帧 Trunk Link干道/中继链路 一般用于交换机间的互连或交换机与路由器之间的链路干道链路上传输的帧几乎都是tagged帧用于两端识别 PVID：Port Vlan identification 端口缺省VLAN 指明该接口属于的VLAN VLAN端口类型： 类型 备注 Untagged 未打标签 Tagged 打标签 Access接入端口 用于连接主机收到数据后会添加VLAN Tag，VLAN ID和端口的PVID相同转发数据前会移除VLAN Tag注意：终端设备（PC）发出和接收的都是untagged的帧，否则无法识别 图例主机AC属于一个VLAN，B属于另一个VLAN,A与C相互通讯的演示 Trunk干道端口 用于连接交换机或路由器收到帧时：如果该帧不包含Tag，将打上端口的PVID；如果该帧包含Tag，则不改变。发送帧时：首先要保证该帧的VLAN ID在Trunk的允许发送列表中（华为默认只允许VLAN1，思科默认允许所有VLAN)若与端口的PVID相同时，则剥离Tag发送；若与端口的PVID不同时，则直接发送。 图例主机A与C通信，主机B与D通信 Hybrid混杂端口 既可以连接主机，又可以连接其他交换机。既可以连接接入链路又可以连接干道链路。允许多个VLAN的帧通过，并可以在出接口方向将某些VLAN帧的Tag剥离掉（由命令决定） 图例主机A与主机B不能相互访问，但都可以访问PVID100的服务器 交换机之间的g0/0/1口可以打标签也可以不打标签，打标签就是Trunk模式，不打就是Acess模式 即 port hybrid tagged vlan 2 3 100这条命令可以不写 Access端口白话解释： 交换机每个接口有PVID，默认PVID=1，可以修改。 当接口为Access模式时： 收到未打标签（untagged）的帧会添加接口的PVID 收到打标签（tagged）的帧会直接修改为tagged帧的VLAN Tag 发帧时统一剥离VLAN Tag（Untagged）并与发送接口的PVID比较，一致转发不一致丢弃 Trunk端口白话解释： 交换机每个接口有PVID，默认PVID=1，可以修改。 接口为Trunk模式时： 收到未打标签的帧，将打上端口的PVID（和access模式一样） 收到打标签的帧，则不改变直接转发 发送帧时，先检查该帧VLAN ID在Trunk的允许发送列表 若发送的帧与端口的PVID相同，剥离Tag发送；（和access模式一样） 若与端口的PVID不同时，则直接发送。 Hybrid端口白话解释：（华为私有接口） 交换机每个接口有PVID，默认PVID=1，可以修改。 可以任意指定数据帧发送或接收是否携带tagged 接口属于混杂模式，既可以是Trunk又可以是Acess 收帧时既可以打上标签（Access），也可以直接转发带标签的帧（Trunk） 发帧时既可以直接转发带标签的帧（Trunk），也可以剥离标签（Acess） 交换机判断VLAN的逻辑： VLAN配置： 命令 备注 vlan 10 创建单个VLAN vlan batch 10 to 20 创建多个VLAN port link-type accessport link-type trunkport link-type hybrid 配置接口类型简写为P L A、P L T、P L H port default vlan 10 配置access关联的VLAN/PVID,简写 P D V 10 port trunk allow-pass vlan 10 配置Trunk允许通过的VLAN，简写P L A V 10华为默认只允许VLAN1 port trunk pvid vlan 10 配置Trunk的PVID port hybrid tagged vlan 10port hybrid untagged vlan 10 配置Hybird标记VLAN（标记和剥离） port hybrid pvid vlan 10 配置Hybird的PVID display vlan 验证VLAN display port vlan 10 验证VLAN 交换机的工作原理： VLAN间路由 VLAN间通信限制：每一个VLAN都是独立的广播域，不同VLAN之间隔离，因此不同VLAN的节点之间是无法直接访问 VLAN间通信方法（路由）： 使用路由器完成不同VLAN通信 （缺点：每一个VLAN就需要绑定一个物理接口） 使用一个接口的子接口（虚拟接口），来绑定VLAN大大减少了资源消耗 交换机设置为Trunk，路由器如何识别VLAN？ dot1q termination vid 10 作用：该子接口与VLAN10绑定，收到VLAN10就剥离VLAN，查看路由表执行路由转发，转发在打上转发接口的PVID 路由器一般用作出口设备（广播域太大），且价格较贵，使用路由器实现VLAN间通信不经济 使用具有路由功能的交换机实现VLAN间通信 VLAN配置： 命令 备注 Vlan 10 创建单个VLAN Vlan batch 10 20 创建多个VLAN Port link-type access/trunk/hybrid 配置接口类型 Port default vlan 10 配置access关联VLAN/PVID Port trunk allow-pass vlan 10 配置trunk允许VLAN通过（默认只允许VLAN1通过） Port trunk pvid vlan 10 配置trunk的PVID Port hybrid tagged/untagged vlan 10 配置hybrid标记VLAN Port hybrid pvid vlan 10 配置hybrid的PVID Display vlan 验证VLAN Display port vlan 验证VLAN Dot1q termination vid 10 子接口和VLAN关联 Arp broadcast enable 开启子接口的ARP广播功能 portswitch 配置接口工作为2层 Undo portswitch 配置接口工作为3层 赣ICP备2023008387号-1 赣公网安备36052102100040号 Copyright ©2022 - 2024 By Feiyu最近一修改时间： 2025-04-09 21:18 "},"5.交换/交换机的工作原理.html":{"url":"5.交换/交换机的工作原理.html","title":"交换机的工作原理","keywords":"","body":"交换基础 网络分层设计： 易于理解、学习、排错 层次 备注 接入层Access layer 用户接入 接入安全 访问控制 汇聚层Distribution layer 流量汇聚 链路冗余 设备冗余 路由选择 核心层Core layer 高速转发 服务器接入 路由选择 出口层Speak layer 广域网接入 出口策略 带宽控制 对层次的带宽要求几何增长 对层次的设备性能要求集合增长 交换机的主要功能： 交换机根据MAC地址来转发数据帧 交换机的工作原理：根据MAC地址表中的MAC地址表项，做出智能转发 原理 备注 学习 Learn 从一个接口收到数据帧时，把数据帧的源MAC地址和该接口进行绑定，存放MAC地址表 泛洪Flood 从一个接口收到广播帧、组播帧、未知单播帧，把该帧从其他所有接口转发出去（除接收口） 转发Forward 从一个接口收到已知单播帧，立即从相应的接口转发出去（除目标地址是自己） 更新Update 交换机地址表中的表项默认的保存300秒交换机重启会清空所有接口学习到的记录接口关闭后会清空该接口学习到的记录一个源MAC地址出现在别的接口上，会删除老的记录，添加新的记录 注： 对应一台交换机来说：一个MAC地址只能关联一个接口上一个接口可以存在多个MAC地址 以太网接口工作模式： 术语 备注 半双工 half-duplex通信双方不能同时发送接收数据 全双工 full-duplex通信双方可以同时发送接收数据 速率 Speed接口两端连接时进行协商，协商失败无法正常通信 可以设置两端的通信模式默认是自动（选取两端设备的最低值） 网络速度无其他因素影响，但网速很慢可能是半双工模式 电脑设置通信模式： 交换机设置通信模式： 术语 备注 undo negotiation auto 取消自动协商 speed 100 设置速率 duplex full 设置通信模式为全双工 duplex half 设置通信模式为半双工 赣ICP备2023008387号-1 赣公网安备36052102100040号 Copyright ©2022 - 2024 By Feiyu最近一修改时间： 2025-04-09 21:13 "},"联系我.html":{"url":"联系我.html","title":"联系我","keywords":"","body":"🏠 主页 网站地址：https://www.feiyunote.cn 🤝 反馈与建议 作者：睡觉的时候不困 邮箱：feiyunote@qq.com 我双手合十的愿望里永远有你。 穿越人海，只为与你相拥。 手握日月摘 ♥ 陈。 📝 备案号 赣ICP备2023008387号-1 赣公网安备36052102100040号 ©2023-2024 睡觉的时候不困 赣ICP备2023008387号-1 赣公网安备36052102100040号 Copyright ©2022 - 2024 By Feiyu最近一修改时间： 2025-04-10 16:09 "}}